<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>AI Music Generation Platform</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Input Source Selection Modal -->
    <div id="inputModal" class="modal">
        <div class="modal-content">
            <h2>Choose Input Source</h2>
            <div class="input-buttons">
                <button class="input-btn" onclick="selectInputSource('phone_camera')" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); selectInputSource('phone_camera');}">📷 Camera</button>
                <button class="input-btn" onclick="selectInputSource('video_file')" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); selectInputSource('video_file');}">🎥 Video File</button>
                <button class="input-btn" onclick="selectInputSource('screen_record')" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); selectInputSource('screen_record');}">📱 Screen Record</button>
                <button class="input-btn" onclick="selectInputSource('network_stream')" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); selectInputSource('network_stream');}">🌐 Network Stream</button>
            </div>
        </div>
    </div>

    <!-- URL Input Modal -->
    <div id="urlModal" class="url-modal">
        <div class="url-modal-content">
            <h3>Enter DashCam Stream URL:</h3>
            <input type="text" id="streamUrl" class="url-input" placeholder="http://192.168.1.100:8080/video">
            <div class="url-buttons">
                <button class="url-btn confirm-btn" onclick="confirmUrl()" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); confirmUrl();}">Confirm</button>
                <button class="url-btn cancel-btn" onclick="cancelUrl()" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); cancelUrl();}">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Main Interface -->
    <div class="menu-frame" id="menuFrame" style="display: none;">
        <div class="title">RagbaarNet AI<br>Platform</div>
        
        <button class="menu-btn" id="changeSourceBtn" onclick="changeInputSource()" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); changeInputSource();}">📂 Change Source</button>
        
        <div class="button-group">
            <button class="menu-btn" onclick="resetRoi()" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); resetRoi();}">🔄 Reset ROI</button>
        </div>
        
        <div class="button-group">
            <button class="menu-btn" id="toggleSegmentationBtn" onclick="toggleFrameProcessing()" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); toggleFrameProcessing();}">🔍 Segmentation View: OFF</button>
        </div>
        
        <button class="music-gen-btn" onclick="startMusicGeneration()" ontouchend="if(event.target===this && isMobileDevice()){event.preventDefault(); startMusicGeneration();}">🎵 Generate Music</button>
        
        <div class="status-section">
            <div class="status-label">Status:</div>
            <div class="status-text" id="statusText">Ready</div>
            
            <div class="status-label">ROI Points:</div>
            <div class="roi-info" id="roiInfo"></div>
        </div>
    </div>

    <div class="display-frame" id="displayFrame" style="display: none;">
        <div class="video-container" id="videoContainer">
            <video id="videoElement" class="video-element" autoplay playsinline muted loop></video>
            <canvas id="roiCanvas" class="canvas-overlay"></canvas>
            <canvas id="segmentationCanvas" class="canvas-overlay" style="display: none; pointer-events: none;"></canvas>
        </div>
        
        <div class="instructions">Drag green points to adjust ROI corners • Drag red points to control edge curves</div>
    </div>

    <!-- Hidden file inputs -->
    <input type="file" id="videoFileInput" class="hidden-input" accept="video/*">

    <!-- External Libraries -->
    <!-- Socket.IO is used for real-time communication between the client and server, enabling features such as live status updates and streaming control. -->
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    
    <!-- External JavaScript -->
    <script src="script.js"></script>
</body>
</html>